<!DOCTYPE html>
<html dir="ltr" class="client-js" lang="en"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>PPU OAM - Nesdev wiki</title>
<meta charset="UTF-8">
<meta name="generator" content="MediaWiki 1.20.2">
<link rel="shortcut icon" href="http://wiki.nesdev.com/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="http://wiki.nesdev.com/w/opensearch_desc.php" title="Nesdev wiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="http://wiki.nesdev.com/w/api.php?action=rsd">
<link rel="alternate" type="application/atom+xml" title="Nesdev wiki Atom feed" href="http://wiki.nesdev.com/w/index.php?title=Special:RecentChanges&amp;feed=atom">
<link rel="stylesheet" href="PPU%20OAM%20-%20Nesdev%20wiki_files/load_002.css">
<!--[if IE 6]><link rel="stylesheet" href="/w/skins/monobook/IE60Fixes.css?303" media="screen" /><![endif]-->
<!--[if IE 7]><link rel="stylesheet" href="/w/skins/monobook/IE70Fixes.css?303" media="screen" /><![endif]--><style>.mw-collapsible-toggle{float:right} li .mw-collapsible-toggle{float:none} .mw-collapsible-toggle-li{list-style:none}
/* cache key: nesdev_wiki-mw1_:resourceloader:filter:minify-css:7:4250852ed2349a0d4d0fc6509a3e7d4c */.suggestions{overflow:hidden;position:absolute;top:0;left:0;width:0;border:none;z-index:1099;padding:0;margin:-1px -1px 0 0} html > body .suggestions{margin:-1px 0 0 0}.suggestions-special{position:relative;background-color:white;cursor:pointer;border:solid 1px #aaaaaa;padding:0;margin:0;margin-top:-2px;display:none;padding:0.25em 0.25em;line-height:1.25em}.suggestions-results{background-color:white;cursor:pointer;border:solid 1px #aaaaaa;padding:0;margin:0}.suggestions-result{color:black;margin:0;line-height:1.5em;padding:0.01em 0.25em;text-align:left}.suggestions-result-current{background-color:#4C59A6;color:white}.suggestions-special .special-label{color:gray;text-align:left}.suggestions-special .special-query{color:black;font-style:italic;text-align:left}.suggestions-special .special-hover{background-color:silver}.suggestions-result-current .special-label,.suggestions-result-current .special-query{color:white}.autoellipsis-matched,.highlight{font-weight:bold}
/* cache key: nesdev_wiki-mw1_:resourceloader:filter:minify-css:7:9780324491b653a3780e2d029bdc140c */</style><meta name="ResourceLoaderDynamicStyles" content="">
<link rel="stylesheet" href="PPU%20OAM%20-%20Nesdev%20wiki_files/load.css">
<style>a:lang(ar),a:lang(ckb),a:lang(fa),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: nesdev_wiki-mw1_:resourceloader:filter:minify-css:7:b2ff0e5460847bfbc2a67ca6bf6f3969 */</style>

<script src="PPU%20OAM%20-%20Nesdev%20wiki_files/load_004.php"></script><script src="PPU%20OAM%20-%20Nesdev%20wiki_files/load_005.php"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"PPU_OAM","wgTitle":"PPU OAM","wgCurRevisionId":7094,"wgArticleId":21,"wgIsArticle":true,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"PPU_OAM","wgRestrictionEdit":[],"wgRestrictionMove":[]});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function(){mw.user.options.set({"ccmeonemails":0,"cols":80,"date":"default","diffonly":0,"disablemail":0,"disablesuggest":0,"editfont":"default","editondblclick":0,"editsection":1,"editsectiononrightclick":0,"enotifminoredits":0,"enotifrevealaddr":0,"enotifusertalkpages":1,"enotifwatchlistpages":0,"extendwatchlist":0,"externaldiff":0,"externaleditor":0,"fancysig":0,"forceeditsummary":0,"gender":"unknown","hideminor":0,"hidepatrolled":0,"imagesize":2,"justify":0,"math":1,"minordefault":0,"newpageshidepatrolled":0,"nocache":0,"noconvertlink":0,"norollbackdiff":0,"numberheadings":0,"previewonfirst":0,"previewontop":1,"quickbar":5,"rcdays":7,"rclimit":50,"rememberpassword":0,"rows":25,"searchlimit":20,"showhiddencats":0,"showjumplinks":1,"shownumberswatching":1,"showtoc":1,"showtoolbar":1,"skin":"monobook","stubthreshold":0,"thumbsize":2,"underline":2,"uselivepreview":0,"usenewrc":0,"watchcreations":0,"watchdefault":0,"watchdeletion":0,"watchlistdays":3,
"watchlisthideanons":0,"watchlisthidebots":0,"watchlisthideliu":0,"watchlisthideminor":0,"watchlisthideown":0,"watchlisthidepatrolled":0,"watchmoves":0,"wllimit":250,"variant":"en","language":"en","searchNs0":true,"searchNs1":false,"searchNs2":false,"searchNs3":false,"searchNs4":false,"searchNs5":false,"searchNs6":false,"searchNs7":false,"searchNs8":false,"searchNs9":false,"searchNs10":false,"searchNs11":false,"searchNs12":false,"searchNs13":false,"searchNs14":false,"searchNs15":false});;},{},{});mw.loader.implement("user.tokens",function(){mw.user.tokens.set({"editToken":"+\\","watchToken":false});;},{},{});
/* cache key: nesdev_wiki-mw1_:resourceloader:filter:minify-js:7:c89fc005766e312c555f83b307d08d63 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax"]);
}</script><script type="text/javascript" src="PPU%20OAM%20-%20Nesdev%20wiki_files/load_003.php"></script><link href="PPU%20OAM%20-%20Nesdev%20wiki_files/FF2Fixes.css" rel="stylesheet" type="text/css">
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-PPU_OAM skin-monobook action-view">
<div id="globalWrapper">
<div id="column-content"><div id="content" class="mw-body-primary">
	<a id="top"></a>
	
	<h1 id="firstHeading" class="firstHeading"><span dir="auto">PPU OAM</span></h1>
	<div id="bodyContent" class="mw-body">
		<div id="siteSub">From Nesdev wiki</div>
		<div id="contentSub"></div>
		<div id="jump-to-nav" class="mw-jump">Jump to: <a href="#column-one">navigation</a>, <a href="#searchInput">search</a></div>
		<!-- start content -->
<div id="mw-content-text" dir="ltr" class="mw-content-ltr" lang="en"><p>The
 OAM (Object Attribute Memory) is internal memory inside the PPU that 
contains a display list of up to 64 sprites, where each sprite's 
information occupies 4 bytes.
</p>
<h3> <span class="mw-headline" id="Byte_0"> Byte 0 </span></h3>
<p>Y position of top of sprite
</p><p>Sprite data is delayed by one scanline; you must subtract 1 from 
the sprite's Y coordinate before writing it here.
Hide a sprite by writing any values in $EF-$FF here.
Sprites are never displayed on the first line of the picture, and it is 
impossible to place a sprite partially off the top of the screen.
</p>
<h3> <span class="mw-headline" id="Byte_1"> Byte 1 </span></h3>
<p>Tile index number
</p><p>For 8x8 sprites, this is the tile number of this sprite within the pattern table selected in bit 3 of <a href="http://wiki.nesdev.com/w/index.php/PPU_registers#Controller_.28.242000.29_.3E_write" title="PPU registers">PPUCTRL ($2000)</a>.
</p><p>For 8x16 sprites, the PPU ignores the pattern table selection and selects a pattern table from bit 0 of this number.
</p>
<pre>76543210
||||||||
|||||||+- Bank ($0000 or $1000) of tiles
+++++++-- Tile number of top of sprite (0 to 254; bottom half gets the next tile)
</pre>
<p>Thus, the pattern table memory map for 8x16 sprites looks like this:
</p>
<ul><li>$00: $0000-$001F
</li><li>$01: $1000-$101F
</li><li>$02: $0020-$003F
</li><li>$03: $1020-$103F
</li><li>$04: $0040-$005F<br>[...]
</li><li>$FE: $0FE0-$0FFF
</li><li>$FF: $1FE0-$1FFF
</li></ul>
<h3> <span class="mw-headline" id="Byte_2"> Byte 2 </span></h3>
<p>Attributes
</p>
<pre>76543210
||||||||
||||||++- Palette (4 to 7) of sprite
|||+++--- Unimplemented
||+------ Priority (0: in front of background; 1: behind background)
|+------- Flip sprite horizontally
+-------- Flip sprite vertically
</pre>
<p>Flipping does not change the position of the sprite's bounding box, 
just the position of pixels within the sprite.
If, for example, a sprite covers (120, 130) through (127, 137), it'll 
still cover the same area when flipped.
In 8x16 mode, vertical flip flips each of the subtiles and also 
exchanges their position; the odd-numbered tile of a vertically flipped 
sprite is drawn on top.
This behavior differs from the behavior of the <a rel="nofollow" class="external text" href="http://wiki.superfamicom.org/snes/show/Registers#obsel__object_size_and_character_address_8">unofficial 16x32 and 32x64 pixel sprite sizes on the Super NES</a>, which <a rel="nofollow" class="external text" href="http://wiki.superfamicom.org/snes/show/Sprites">will only vertically flip each square sub-region</a>.
</p><p>The three unimplemented bits of each sprite's byte 2 do not exist
 in the PPU and always read back as 0 on PPU revisions that allow 
reading PPU OAM through OAMDATA ($2004). This can be emulated by ANDing 
byte 2 with $E3 either when writing to or when reading from OAM. It has 
not been determined whether the PPU actually drives these bits low or 
whether this is the effect of data bus capacitance from reading the last
 byte of the instruction (LDA $2004, which assembles to AD 04 20).
</p>
<h3> <span class="mw-headline" id="Byte_3"> Byte 3 </span></h3>
<p>X position of left side of sprite
</p><p>X-scroll values of F9-FF do NOT result in the sprite wrapping around to the left side of the screen.
</p>
<h3> <span class="mw-headline" id="DMA"> DMA </span></h3>
<p>Most programs write to a copy of OAM somewhere in CPU addressable RAM
 (often $0200-$02FF) and then copy it to OAM each frame using the 
OAM_DMA ($4014) register. Writing <i>value</i> to this register causes 
the DMA circuitry inside the 2A03/07 to fully initialize the OAM by 
writing OAMDATA ($2004) 256 times using successive bytes from memory 
page <i>value</i> (i.e., starting at address $100×<i>value</i>). The CPU is suspended while the transfer is taking place.
</p><p>Note that the address range to copy from could lie outside RAM, though that happens very rarely in practice.
</p><p>Not counting the $4014 write tick, the above procedure takes 513 
CPU cycles (+1 on odd CPU cycles): first one (or two) idle cycles, and 
then 256 pairs of alternating read/write cycles. (For comparison, an 
unrolled LDA/STA loop would usually take four times as long.)
</p>
<h3> <span class="mw-headline" id="Sprite_zero_hits"> Sprite zero hits </span></h3>
<p>The sprite zero hit flag (<a href="http://wiki.nesdev.com/w/index.php/PPU_registers#Status_.28.242002.29_.3C_read" title="PPU registers">$2002</a>:6)
 is raised during image drawing at the point (if any) where a non-bg 
background pixel overlaps a non-bg sprite zero pixel ("non-bg" simply 
means that the pattern bits for the pixel are <i>not</i> both zero; the 
value at the corresponding index in the palette RAM does not matter), 
provided that background and sprite rendering are both enabled (via <a href="http://wiki.nesdev.com/w/index.php/PPU_registers#Mask_.28.242001.29_.3E_write" title="PPU registers">$2001</a>:4-3). Sprite zero hits do not register at x=255 (independent of sprite zero's x coordinate), but sprites are still drawn there.
</p><p>The sprite zero flag is automatically set to 0 at dot 1 of the 
pre-render line. There is no way to manually reset it, which means that 
you only get one sprite zero hit per frame.
</p>
<h3> <span class="mw-headline" id="Sprite_overlapping"> Sprite overlapping </span></h3>
<p><a href="http://wiki.nesdev.com/w/index.php/PPU_sprite_priority" title="PPU sprite priority">Priority between sprites</a>
 is determined by their address inside OAM.
So to have a sprite displayed in front of another sprite in a scanline, 
the sprite data that occurs first will overlap any other sprites after 
it.
For example, when sprites at OAM $0C and $28 overlap, the sprite at $0C 
will appear in front.
</p>
<h3> <span class="mw-headline" id="Internal_operation"> Internal operation </span></h3>
<p>In addition to the primary OAM memory, the PPU contains 32 bytes 
(enough for 8 sprites) of secondary OAM memory that is not directly 
accessible by the program. During each visible scanline this secondary 
OAM is first cleared, and then a linear search of the entire primary OAM
 is carried out to find sprites that are within y range for the <b>next</b> scanline (the <i>sprite evaluation</i>
 phase). The OAM data for each sprite found to be within range is copied
 into the secondary OAM, which is then used to initialize eight internal
 sprite output units.
</p><p>For the precise timing, see <a href="http://wiki.nesdev.com/w/images/d/d1/Ntsc_timing.png" class="internal" title="Ntsc timing.png">this timing diagram</a>.
</p><p>The reason sprites at lower addresses in OAM overlap sprites at 
higher addresses is that sprites at lower addresses also get assigned a 
lower address in the secondary OAM, and hence get assigned a 
lower-numbered sprite output unit during the loading phase. Output from 
lower-numbered sprite output units is wired inside the PPU to take 
priority over output from higher-numbered sprite output units.
</p><p>Sprite zero hit detection relies on the fact that sprite zero, 
when it is within y range for the next scanline, always gets assigned 
the first sprite output unit. The hit condition is basically <i>sprite zero is in range</i> <b>AND</b> <i>the first sprite output unit is outputting a non-zero pixel</i> <b>AND</b> <i>the background drawing unit is outputting a non-zero pixel</i>. (Internally the PPU actually uses <b>two</b> flags: one to keep track of whether sprite zero occurs on the <i>next</i> scanline, and another one—initialized from the first—to keep track of whether sprite zero occurs on the <i>current</i>
 scanline. This is to avoid sprite evaluation, which takes place 
concurrently with potential sprite zero hits, trampling on the second 
flag.)
</p>
<h3> <span class="mw-headline" id="See_also:"> See also: </span></h3>
<ul><li> <a href="http://wiki.nesdev.com/w/index.php/PPU_sprite_evaluation" title="PPU sprite evaluation">PPU sprite evaluation</a>
</li></ul>

<!-- 
NewPP limit report
Preprocessor visited node count: 35/1000000
Preprocessor generated node count: 40/1000000
Post-expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key nesdev_wiki-mw1_:pcache:idhash:21-0!*!0!!*!*!* and timestamp 20140410204305 -->
</div><div class="printfooter">
Retrieved from "<a href="http://wiki.nesdev.com/w/index.php?title=PPU_OAM&amp;oldid=7094">http://wiki.nesdev.com/w/index.php?title=PPU_OAM&amp;oldid=7094</a>"</div>
		<div id="catlinks" class="catlinks catlinks-allhidden"></div>		<!-- end content -->
				<div class="visualClear"></div>
	</div>
</div></div>
<div id="column-one">
	<div id="p-cactions" class="portlet">
		<h5>Views</h5>
		<div class="pBody">
			<ul>
				<li id="ca-nstab-main" class="selected"><a href="http://wiki.nesdev.com/w/index.php/PPU_OAM" primary="1" context="subject" title="View the content page [alt-shift-c]" accesskey="c">Page</a></li>
				<li id="ca-talk"><a href="http://wiki.nesdev.com/w/index.php/Talk:PPU_OAM" primary="1" context="talk" title="Discussion about the content page [alt-shift-t]" accesskey="t">Discussion</a></li>
				<li id="ca-viewsource"><a href="http://wiki.nesdev.com/w/index.php?title=PPU_OAM&amp;action=edit" primary="1" title="This page is protected.
You can view its source [alt-shift-e]" accesskey="e">View source</a></li>
				<li id="ca-history"><a href="http://wiki.nesdev.com/w/index.php?title=PPU_OAM&amp;action=history" rel="archives" title="Past revisions of this page [alt-shift-h]" accesskey="h">History</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-personal">
		<h5>Personal tools</h5>
		<div class="pBody">
			<ul>
				<li id="pt-createaccount"><a href="http://wiki.nesdev.com/w/index.php?title=Special:UserLogin&amp;returnto=PPU+OAM&amp;type=signup">Create account</a></li>
				<li id="pt-login"><a href="http://wiki.nesdev.com/w/index.php?title=Special:UserLogin&amp;returnto=PPU+OAM" title="You are encouraged to log in; however, it is not mandatory [alt-shift-o]" accesskey="o">Log in</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-logo">
<a href="http://wiki.nesdev.com/w/index.php/Nesdev_Wiki" style="background-image: url(/w/skins/common/images/NESdevWikiLogo7.png);" title="Visit the main page"></a>
	</div>
	<div class="generated-sidebar portlet" id="p-navigation">
		<h5>Navigation</h5>
		<div class="pBody">
			<ul>
				<li id="n-Nesdev-main-page"><a href="http://wiki.nesdev.com/w/index.php/Nesdev">Nesdev main page</a></li>
				<li id="n-Wiki-main-page"><a href="http://wiki.nesdev.com/w/index.php/Nesdev_Wiki">Wiki main page</a></li>
				<li id="n-NES-reference-guide"><a href="http://wiki.nesdev.com/w/index.php/NES_reference_guide">NES reference guide</a></li>
				<li id="n-Programming-guide"><a href="http://wiki.nesdev.com/w/index.php/Programming_guide">Programming guide</a></li>
				<li id="n-Projects"><a href="http://wiki.nesdev.com/w/index.php/Projects">Projects</a></li>
				<li id="n-Offline-HTML-version"><a href="http://wiki.nesdev.com/w/nesdevwiki_2014-03-13.zip" rel="nofollow">Offline HTML version</a></li>
				<li id="n-NESdev-BBS"><a href="http://forums.nesdev.com/" rel="nofollow">NESdev BBS</a></li>
				<li id="n-.23NESdev"><a href="http://wiki.nesdev.com/w/index.php/NESdev_IRC_channel">#NESdev</a></li>
				<li id="n-recentchanges"><a href="http://wiki.nesdev.com/w/index.php/Special:RecentChanges" title="A list of recent changes in the wiki [alt-shift-r]" accesskey="r">Recent changes</a></li>
			</ul>
		</div>
	</div>
	<div id="p-search" class="portlet">
		<h5><label for="searchInput">Search</label></h5>
		<div id="searchBody" class="pBody">
			<form action="/w/index.php" id="searchform">
				<input name="title" value="Special:Search" type="hidden">
				<input placeholder="Search" autocomplete="off" name="search" title="Search Nesdev wiki [alt-shift-f]" accesskey="f" id="searchInput" type="search">
				<input name="go" value="Go" title="Go to a page with this exact name if exists" id="searchGoButton" class="searchButton" type="submit">&nbsp;
				<input name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton" type="submit">
			</form>
		</div>
	</div>
	<div class="portlet" id="p-tb">
		<h5>Toolbox</h5>
		<div class="pBody">
			<ul>
				<li id="t-whatlinkshere"><a href="http://wiki.nesdev.com/w/index.php/Special:WhatLinksHere/PPU_OAM" title="A list of all wiki pages that link here [alt-shift-j]" accesskey="j">What links here</a></li>
				<li id="t-recentchangeslinked"><a href="http://wiki.nesdev.com/w/index.php/Special:RecentChangesLinked/PPU_OAM" title="Recent changes in pages linked from this page [alt-shift-k]" accesskey="k">Related changes</a></li>
				<li id="t-specialpages"><a href="http://wiki.nesdev.com/w/index.php/Special:SpecialPages" title="A list of all special pages [alt-shift-q]" accesskey="q">Special pages</a></li>
				<li id="t-print"><a href="http://wiki.nesdev.com/w/index.php?title=PPU_OAM&amp;printable=yes" rel="alternate" title="Printable version of this page [alt-shift-p]" accesskey="p">Printable version</a></li>
				<li id="t-permalink"><a href="http://wiki.nesdev.com/w/index.php?title=PPU_OAM&amp;oldid=7094" title="Permanent link to this revision of the page">Permanent link</a></li>
			</ul>
		</div>
	</div>
</div><!-- end of the left (by default at least) column -->
<div class="visualClear"></div>
<div id="footer">
	<div id="f-poweredbyico">
		<a href="http://www.mediawiki.org/"><img src="PPU%20OAM%20-%20Nesdev%20wiki_files/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" height="31" width="88"></a>
	</div>
	<ul id="f-list">
		<li id="lastmod"> This page was last modified on 21 July 2013, at 21:33.</li>
		<li id="viewcount">This page has been accessed 14,594 times.</li>
		<li id="privacy"><a href="http://wiki.nesdev.com/w/index.php/Nesdev_wiki:Privacy_policy" title="Nesdev wiki:Privacy policy">Privacy policy</a></li>
		<li id="about"><a href="http://wiki.nesdev.com/w/index.php/Nesdev_wiki:About" title="Nesdev wiki:About">About Nesdev wiki</a></li>
		<li id="disclaimer"><a href="http://wiki.nesdev.com/w/index.php/Nesdev_wiki:General_disclaimer" title="Nesdev wiki:General disclaimer">Disclaimers</a></li>
	</ul>
</div>
</div>
<script>if(window.mw){
mw.loader.state({"site":"loading","user":"missing","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.user","mediawiki.page.ready","mediawiki.searchSuggest"], null, true);
}</script><script type="text/javascript" src="PPU%20OAM%20-%20Nesdev%20wiki_files/load_002.php"></script>
<script src="PPU%20OAM%20-%20Nesdev%20wiki_files/load.php"></script>
<!-- Served in 0.170 secs. --><div class="suggestions" style="display: none; font-size: 11.4667px;"><div class="suggestions-results"></div><div class="suggestions-special"></div></div></body></html>